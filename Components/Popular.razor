@using System.Collections.Generic
@using edu_croaker.Data 
@using edu_croaker.Dtos
@using edu_croaker.Services

@inject CroakService CroakSrv
@implements IDisposable

@namespace Components 

<div class="card"> 
    <div class ="card-body">
        <h5>Trending</h5>
    </div>
    <ul class="list-group list-group-flush">
        @foreach (var htPopularity in hashtagPopularities)
        {
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="/byHashtag/@htPopularity.Hashtag.Id">
                    #@htPopularity.Hashtag.Caption
                </a>
                <span class="badge badge-light badge-pill">@htPopularity.HitCount</span>
            </li>
        }
    </ul>
</div>

@code {
    private IEnumerable<HashtagPopularity> hashtagPopularities = new List<HashtagPopularity>();
    
    protected override async Task OnInitializedAsync()
    {
        CroakSrv.NotifyOnChange += OnChange;
        await FetchPopularHashtags();
    }

    public async Task OnChange()
    {
        await FetchPopularHashtags();
    }

    protected async Task FetchPopularHashtags()
    {
        hashtagPopularities = await CroakSrv.GetPopularHastags();
        StateHasChanged();
    }

    public void Dispose()
    {
        CroakSrv.NotifyOnChange -= OnChange;
    }
}